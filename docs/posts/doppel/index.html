<!DOCTYPE html>
<html
  dir="ltr"
  lang="en"
  data-theme=""
  class="html"
><head>
  <title>
    Allan Randall
        |
        Finding a Celebrate Look Alike with OpenCV


      


    

  </title>

  
  <meta charset="utf-8" /><meta name="generator" content="Hugo 0.105.0"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="author" content="Allan Randall" />
  <meta
    name="description"
    content="Hi there! I&#39;m a software engineer living in Melbourne, Australia."
  />
  
  
    
    
    <link
      rel="stylesheet"
      href="/scss/main.min.b2e0cb07595e3519ab1193bb421914e06c0e26b0cc561fef23b3c6131d4d2ffa.css"
      integrity="sha256-suDLB1leNRmrEZO7QhkU4GwOJrDMVh/vI7PGEx1NL/o="
      crossorigin="anonymous"
      type="text/css"
    />

  

  
  <link
    rel="stylesheet"
    href="/css/markupHighlight.min.31b0a1f317f55c529a460897848c97436bb138b19c399b37de70d463a8bf6ed5.css"
    integrity="sha256-MbCh8xf1XFKaRgiXhIyXQ2uxOLGcOZs33nDUY6i/btU="
    crossorigin="anonymous"
    type="text/css"
  />
  
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/fontawesome.min.7d272de35b410fb165377550cdf9c4d3a80fbbcc961e111914e4d5c0eaf5729f.css"
    integrity="sha256-fSct41tBD7FlN3VQzfnE06gPu8yWHhEZFOTVwOr1cp8="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/solid.min.55d8333481b07a08e07cf6f37319753a2b47e99f4c395394c5747b48b495aa9b.css"
    integrity="sha256-VdgzNIGwegjgfPbzcxl1OitH6Z9MOVOUxXR7SLSVqps="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/regular.min.a7448d02590b43449364b6b5922ed9af5410abb4de4238412a830316dedb850b.css"
    integrity="sha256-p0SNAlkLQ0STZLa1ki7Zr1QQq7TeQjhBKoMDFt7bhQs="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link
    rel="stylesheet"
    href="/fontawesome/css/brands.min.9ed75a5d670c953fe4df935937674b4646f92674367e9e66eb995bb04e821647.css"
    integrity="sha256-ntdaXWcMlT/k35NZN2dLRkb5JnQ2fp5m65lbsE6CFkc="
    crossorigin="anonymous"
    type="text/css"
  />
  
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />

  <link rel="canonical" href="https://allanrandall.com/posts/doppel/" />

  
  
  
  
  <script
    type="text/javascript"
    src="/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js"
    integrity="sha256-&#43;RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI="
    crossorigin="anonymous"
  ></script>

  
    
    
    <script
      type="text/javascript"
      src="/js/anatole-theme-switcher.min.738c0e3a493854876aeab9e2316fd43f1936aeeac4cc6b3e60bb26456dba72ad.js"
      integrity="sha256-c4wOOkk4VIdq6rniMW/UPxk2rurEzGs&#43;YLsmRW26cq0="
      crossorigin="anonymous"
    ></script>

  

  


  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Finding a Celebrate Look Alike with OpenCV"/>
<meta name="twitter:description" content="Explains my approach to solving the Computer Vision 2 Find Celebrity Look-Alike project."/>



  
  <meta property="og:title" content="Finding a Celebrate Look Alike with OpenCV" />
<meta property="og:description" content="Explains my approach to solving the Computer Vision 2 Find Celebrity Look-Alike project." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://allanrandall.com/posts/doppel/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-08T16:55:07+11:00" />
<meta property="article:modified_time" content="2022-01-08T16:55:07+11:00" /><meta property="og:site_name" content="Allan Randall" />




  
  
  
  
  <script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "articleSection": "posts",
        "name": "Finding a Celebrate Look Alike with OpenCV",
        "headline": "Finding a Celebrate Look Alike with OpenCV",
        "alternativeHeadline": "",
        "description": "
      
        Explains my approach to solving the \u003ca href=\u0022https:\/\/opencv.org\/course-computer-vision-two\/\u0022\u003eComputer Vision 2\u003c\/a\u003e Find Celebrity Look-Alike project.


      


    ",
        "inLanguage": "en",
        "isFamilyFriendly": "true",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/allanrandall.com\/posts\/doppel\/"
        },
        "author" : {
            "@type": "Person",
            "name": "Allan Randall"
        },
        "creator" : {
            "@type": "Person",
            "name": "Allan Randall"
        },
        "accountablePerson" : {
            "@type": "Person",
            "name": "Allan Randall"
        },
        "copyrightHolder" : {
            "@type": "Person",
            "name": "Allan Randall"
        },
        "copyrightYear" : "2022",
        "dateCreated": "2022-01-08T16:55:07.00Z",
        "datePublished": "2022-01-08T16:55:07.00Z",
        "dateModified": "2022-01-08T16:55:07.00Z",
        "publisher":{
            "@type":"Organization",
            "name": "Allan Randall",
            "url": "https://allanrandall.com/",
            "logo": {
                "@type": "ImageObject",
                "url": "https:\/\/allanrandall.com\/favicon-32x32.png",
                "width":"32",
                "height":"32"
            }
        },
        "image": 
      [
      ]

    ,
        "url" : "https:\/\/allanrandall.com\/posts\/doppel\/",
        "wordCount" : "1149",
        "genre" : [ ],
        "keywords" : [ 
      
      "opencv"

    ]
    }
  </script>



</head>
<body
    
      class="body theme--light"

    
  >
    <div class="wrapper">
      <aside
        
          class="wrapper__sidebar"

        
      ><div
  class="sidebar
    animated fadeInDown

  "
>
  <div class="sidebar__content">
    <div class="sidebar__introduction">
      <img
        class="sidebar__introduction-profileimage"
        src="https://www.gravatar.com/avatar/e03c396094883ef16085c6c65bd33505?s=240"
        alt="profile picture"
      />
      
        <div class="sidebar__introduction-title">
          <a href="/">Allan Randall</a>
        </div>

      
      <div class="sidebar__introduction-description">
        <p>Hi there! I'm a software engineer living in Melbourne, Australia.</p>
      </div>
    </div>
    <ul class="sidebar__list">
      
        <li class="sidebar__list-item">
          <a
            href="https://www.linkedin.com/in/allanau/"
            target="_blank"
            rel="noopener"
            aria-label="Linkedin"
            title="Linkedin"
          >
            <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
        <li class="sidebar__list-item">
          <a
            href="https://github.com/arandall"
            target="_blank"
            rel="noopener"
            aria-label="Github"
            title="Github"
          >
            <i class="fab fa-github fa-2x" aria-hidden="true"></i>
          </a>
        </li>

      
    </ul>
  </div><footer class="footer footer__sidebar">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Allan Randall
        2022


      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9BR3BLS2S8"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9BR3BLS2S8', { 'anonymize_ip': false });
}
</script>
</div>
</aside>
      <main
        
          class="wrapper__main"

        
      >
        <header class="header"><div
  class="
    animated fadeInDown

  "
>
  <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
    <span aria-hidden="true" class="navbar-burger__line"></span>
  </a>
  <nav class="nav">
    <ul class="nav__list" id="navMenu">
      
      
    </ul>
    <ul class="nav__list nav__list--end">
      
      
        <li class="nav__list-item">
          <div class="themeswitch">
            <a title="Switch Theme">
              <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a>
          </div>
        </li>

      
    </ul>
  </nav>
</div>
</header>
  <div
    class="post 
      animated fadeInDown

    "
  >
    
    <div class="post__content">
      <h1>Finding a Celebrate Look Alike With OpenCV</h1>
      <p>This post explains my approach to solving the <a href="https://opencv.org/course-computer-vision-two/">Computer Vision 2</a> Find Celebrity Look-Alike project.</p>
<blockquote>
<p>Your Task</p>
<p>In this project, we will build a Fun Application - We will use the Face Embeddings to find a doppelganger or look-alike to a given person. Specifically, we will give you images of two persons and a celebrity dataset. Your task will be to find their celebrity look-alike.</p>
<p>&ndash; Computer Vision 2 / Project 2: DoppelGanger - Find Celebrity Look-Alike</p>
</blockquote>
<div class="toc">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#getting-started">Getting Started</a></li>
    <li><a href="#enrolment">Enrolment</a>
      <ul>
        <li><a href="#step-1-open-and-convert-image">Step 1: Open and convert image</a></li>
        <li><a href="#step-2-detecting-faces">Step 2: detecting faces</a></li>
        <li><a href="#step-3-discover-facial-landmarks">Step 3: Discover Facial Landmarks</a></li>
        <li><a href="#step-4-compute-face-descriptor">Step 4: Compute face descriptor</a></li>
        <li><a href="#step-5-store-face-descriptor--label">Step 5: Store face descriptor / label</a></li>
      </ul>
    </li>
    <li><a href="#saving-time">Saving Time</a></li>
    <li><a href="#finding-a-doppelganger">Finding a Doppelganger</a></li>
    <li><a href="#the-results">The results</a></li>
    <li><a href="#improvements">Improvements</a>
      <ul>
        <li><a href="#use-a-threshold">Use a Threshold</a></li>
        <li><a href="#enrol-more-celebrities">Enrol More Celebrities</a></li>
      </ul>
    </li>
  </ul>
</nav>
</div>
<h2 id="getting-started">Getting Started</h2>
<p>As part of the course material, some of the traditional face recognition caught my eye. Specifically the <a href="https://learnopencv.com/eigenface-using-opencv-c-python/">Eigen Faces video from LearnOpenCV</a>.</p>
<p>I considered using Fisherfaces first but quickly realised that the approach of all of the methods was to take a face and project into a high-dimensional space. Facial detection is performed by detecting the distance (Euclidean distance) between known faces to determine the closest match. To detect a doppelganger my thinking is that I will need to ignore or greatly increase the threshold to get looser matches.</p>
<p>With this in mind, I concluded that the best approach would be to use the most accurate model to generate a metric from an image. The obvious choice is the <a href="http://blog.dlib.net/2017/02/high-quality-face-recognition-with-deep.html">dlib pre-trained deep learning model</a>.</p>
<p>As part of the course, a subset of the <a href="https://www.robots.ox.ac.uk/~vgg/data/celebrity_together/">Celebrity Together</a> was provided making the enrolment step a bit easier. There was one minor issue which I&rsquo;ll go into detail about later.</p>
<h2 id="enrolment">Enrolment</h2>
<p>With a model able to turn any image into 128-dimensional vector we can build up a list of labelled vectors from the pre labelled Celebrity Together images.</p>
<p><img src="enrolment.png" alt="Enrolment"></p>
<p>The image above shows the process we must go through for each image to convert them from a jpeg to a face descriptor using dlib. I have used a 2d plot of 2 colours to indicate 2 different celebrities. In theory, as we process each image, photos of the same celebrity should be &ldquo;closer&rdquo; together.</p>
<p>The process we use for each image:</p>
<ol>
<li>Convert the image to RGB, the format required for dlib</li>
<li>Detect Faces in the image</li>
<li>Discover the facial landmarks</li>
<li>Compute face descriptor</li>
<li>Store face descriptor/label</li>
</ol>
<h3 id="step-1-open-and-convert-image">Step 1: Open and convert image</h3>
<p>Both <a href="https://docs.opencv.org/3.4/d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">opening of the file</a> and <a href="https://docs.opencv.org/3.4/d8/d01/group__imgproc__color__conversions.html#ga397ae87e1288a81d2363b61574eb8cab">converting the colour</a> are simple functions within OpenCV so not a lot to add here other than maybe I should have added a check that the file opened successfully.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enrol</span>(imgPath, label):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">global</span> faceDescriptors, index
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(imgPath)
</span></span><span style="display:flex;"><span>    img <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(img, cv2<span style="color:#f92672">.</span>COLOR_BGR2RGB)
</span></span></code></pre></div><h3 id="step-2-detecting-faces">Step 2: detecting faces</h3>
<p>In this step, I hit a bit of a bump in the road. I made the wrong assumption that all of the images were clean and contained exactly one and only one face. The <code>faceDetector = dlib.get_frontal_face_detector()</code> returns an array but originally I simply assumed that I could use <code>faces[0]</code> and I&rsquo;d be good.</p>
<p>Didn&rsquo;t take long for my code to blow up and realise that there are cases where the number of faces detected was not equal to 1 so I updated my code to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    faces <span style="color:#f92672">=</span> faceDetector(img)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> len(faces) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74"> Faces found in </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">. Skipping&#34;</span><span style="color:#f92672">.</span>format(len(faces), imgPath))
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span></code></pre></div><p>After adding this I found a number of cases in the dataset provided were wasn&rsquo;t a single face. eg.</p>
<pre tabindex="0"><code>0 Face(s) found in ../resource/asnlib/publicdata/celeb_mini/n00002000/n00002000_00000809.JPEG. Skipping
2 Face(s) found in ../resource/asnlib/publicdata/celeb_mini/n00002394/n00002394_00000221.JPEG. Skipping
</code></pre><p>Why?</p>
<p><img src="n00002000_00000809.JPEG" alt="n00002000_00000809.JPEG"><img src="n00002394_00000221.JPEG" alt="n00002394_00000221.JPEG"></p>
<p>In the first image, the face is obscured with a hand.</p>
<p>In the second image, I realised that the data set came from &ldquo;Celebrity Together&rdquo; suggesting that there could be more than one person in an image.</p>
<p>I considered diving in more to extract the correct face as per the label or even using the full dataset from its source but concluded that the mission here was to find a doppelganger and made the call that I&rsquo;d exclude these images.</p>
<h3 id="step-3-discover-facial-landmarks">Step 3: Discover Facial Landmarks</h3>
<p>Using dlib to discover the facial landmarks is relatively simple <code>shapePredictor = dlib.shape_predictor(PREDICTOR_PATH)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#75715e"># Find facial landmarks for each detected face</span>
</span></span><span style="display:flex;"><span>    shape <span style="color:#f92672">=</span> shapePredictor(img, faces[<span style="color:#ae81ff">0</span>])
</span></span></code></pre></div><h3 id="step-4-compute-face-descriptor">Step 4: Compute face descriptor</h3>
<p>Again dlib is used to compute the face descriptor <code>faceRecognizer = dlib.face_recognition_model_v1(FACE_RECOGNITION_MODEL_PATH)</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    faceDescriptor <span style="color:#f92672">=</span> faceRecognizer<span style="color:#f92672">.</span>compute_face_descriptor(img, shape)
</span></span></code></pre></div><p>To make it easier for us later to calculate distances, we need to convert the 128-dimensional vector into a NumPy array using the code below.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#75715e"># Convert face descriptor from Dlib&#39;s format to list, then a NumPy array</span>
</span></span><span style="display:flex;"><span>    faceDescriptorList <span style="color:#f92672">=</span> [x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> faceDescriptor]
</span></span><span style="display:flex;"><span>    faceDescriptorNdarray <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>asarray(faceDescriptorList, dtype<span style="color:#f92672">=</span>np<span style="color:#f92672">.</span>float64)
</span></span><span style="display:flex;"><span>    faceDescriptorNdarray <span style="color:#f92672">=</span> faceDescriptorNdarray[np<span style="color:#f92672">.</span>newaxis, :]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> faceDescriptorNdarray
</span></span></code></pre></div><h3 id="step-5-store-face-descriptor--label">Step 5: Store face descriptor / label</h3>
<p>The final stage is to add the image as a row in the faceDescriptors matrix.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> faceDescriptors <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        faceDescriptors <span style="color:#f92672">=</span> faceDescriptor
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        faceDescriptors <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>concatenate((faceDescriptors, faceDescriptor), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
</span></span></code></pre></div><p>And to store the label and other useful details for that vector/image for retrieval later.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    index<span style="color:#f92672">.</span>append({
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;name&#34;</span>: labelMap[label], 
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;label&#34;</span>: label,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;image&#34;</span>: imgPath,
</span></span><span style="display:flex;"><span>    })
</span></span></code></pre></div><h2 id="saving-time">Saving Time</h2>
<p>I added the following lines after enrolling all of the images so that I had a snapshot of the <code>faceDescriptors</code> and <code>index</code> allowing me to walk away and come back later without having to run an enrolment first.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>np<span style="color:#f92672">.</span>save(<span style="color:#e6db74">&#39;descriptors.npy&#39;</span>, faceDescriptors)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;index.pkl&#39;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    cPickle<span style="color:#f92672">.</span>dump(index, f)
</span></span></code></pre></div><p>And to read it back into variables</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    index <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;index.pkl&#39;</span>, allow_pickle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    faceDescriptorsEnrolled <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>load(<span style="color:#e6db74">&#39;descriptors.npy&#39;</span>)
</span></span></code></pre></div><h2 id="finding-a-doppelganger">Finding a Doppelganger</h2>
<p><img src="find.png" alt="Finding a Doppelganger"></p>
<p>Finding a doppelganger is almost the exact same process as enrolment. Steps 1 - 4 are identical.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    im <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(test)
</span></span><span style="display:flex;"><span>    imDlib <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>cvtColor(im, cv2<span style="color:#f92672">.</span>COLOR_BGR2RGB)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    faces <span style="color:#f92672">=</span> faceDetector(cv2<span style="color:#f92672">.</span>cvtColor(im, cv2<span style="color:#f92672">.</span>COLOR_BGR2RGB))
</span></span><span style="display:flex;"><span>    faceDescriptor <span style="color:#f92672">=</span> calcFaceDescriptor(im, faces[<span style="color:#ae81ff">0</span>])
</span></span></code></pre></div><p>Now we&rsquo;ve calculated the descriptor for the face in the image whom we&rsquo;d like to find their celebrity look alike we need to find the closest match in our celebrity <code>faceDescriptors</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate Euclidean distances between face descriptor calculated on face dectected</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># in current frame with all the face descriptors we calculated while enrolling faces</span>
</span></span><span style="display:flex;"><span>    distances <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>linalg<span style="color:#f92672">.</span>norm(faceDescriptorsEnrolled <span style="color:#f92672">-</span> faceDescriptor, axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Calculate minimum distance and index of this face</span>
</span></span><span style="display:flex;"><span>    argmin <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>argmin(distances)  <span style="color:#75715e"># index</span>
</span></span></code></pre></div><p>Using the index of the row we can now pull back the Celebrity name and the image that we determined as their look alike.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    celeb_name <span style="color:#f92672">=</span> index[argmin][<span style="color:#e6db74">&#34;name&#34;</span>]
</span></span><span style="display:flex;"><span>    celeb_img  <span style="color:#f92672">=</span> cv2<span style="color:#f92672">.</span>imread(index[argmin][<span style="color:#e6db74">&#34;image&#34;</span>])
</span></span></code></pre></div><h2 id="the-results">The results</h2>
<p>Running using the test images **drumroll**</p>
<p>Sofia Solares looks like</p>
<p><img src="sofia.png" alt=""></p>
<p>Shashikant Pedwal looks like</p>
<p><img src="shashikant.png" alt=""></p>
<p>And I apparently look like</p>
<p><img src="me.png" alt=""></p>
<h2 id="improvements">Improvements</h2>
<p>While working on this project I considered the following but considered them unnecessary.</p>
<h3 id="use-a-threshold">Use a Threshold</h3>
<p>A <code>THRESHOLD</code> could be introduced to minimise bad matches. I decided instead to always return the closest enrolled celebrity which in the images I tried was adequate.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    minDistance <span style="color:#f92672">=</span> distances[argmin]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> minDistance <span style="color:#f92672">&lt;=</span> THRESHOLD:
</span></span><span style="display:flex;"><span>        label <span style="color:#f92672">=</span> index[argmin]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        label <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;unknown&#39;</span>
</span></span></code></pre></div><h3 id="enrol-more-celebrities">Enrol More Celebrities</h3>
<p>The mini dataset contained 1,166 celebrities however Celebrity Together boasts that it contains 2,622 which may give better matches for some individuals but I was happy enough with the results from the mini set.</p>
</div>
    <div class="post__footer">
      

      
        <span><a class="tag" href="/tags/opencv/">opencv</a></span>




      
    </div>

    
  </div>


      </main>
    </div><footer class="footer footer__base">
  <ul class="footer__list">
    <li class="footer__item">
      &copy;
      
        Allan Randall
        2022


      
    </li>
    
  </ul>
</footer>
  
  <script
    type="text/javascript"
    src="/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js"
    integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ="
    crossorigin="anonymous"
  ></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9BR3BLS2S8"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-9BR3BLS2S8', { 'anonymize_ip': false });
}
</script>
</body>
</html>
